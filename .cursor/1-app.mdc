---
alwaysApply: false
---
## Product & System Description â€” Daily + Ask AI (Agentic SaaS)

### 1. Cel produktu

Budujemy aplikacjÄ™ SaaS typu **personal daily intelligence / reflective assistant**, w ktÃ³rej uÅ¼ytkownik:

* codziennie zapisuje plany, myÅ›li i obserwacje (Daily),
* moÅ¼e zadawaÄ‡ pytania o swojÄ… przeszÅ‚Ä… aktywnoÅ›Ä‡ i wzorce (Ask AI),
* a system sam dba o pamiÄ™Ä‡, podsumowania i kontekst dla agentÃ³w AI.

Kluczowe zaÅ‚oÅ¼enie:
**UX jest chat-like, ale architektura NIE jest klasycznym chatem wszÄ™dzie.**

---

### 2. Dwa gÅ‚Ã³wne flow uÅ¼ytkownika

#### A) Daily (codzienny journaling / check-in)

* Wizualnie: chat experience (bubble, timeline, input na dole).
* Technicznie: **brak threadÃ³w**, brak short-term memory.
* KaÅ¼da wiadomoÅ›Ä‡ to **atomowy event dnia**, nie czÄ™Å›Ä‡ rozmowy.

Daily sÅ‚uÅ¼y do:

* zapisywania planÃ³w dnia,
* notatek, przemyÅ›leÅ„, obserwacji,
* incydentalnych pytaÅ„ o przeszÅ‚oÅ›Ä‡ (np. â€kiedy ostatnio robiÅ‚em Xâ€).

Daily **nie jest miejscem do prowadzenia dÅ‚ugiej konwersacji**.

---

#### B) Ask AI (refleksja / eksploracja)

* Klasyczny chat jak w ChatGPT.
* KaÅ¼da rozmowa ma **thread_id**.
* Wykorzystuje short-term memory (historia rozmowy) + long-term memory (Supabase).

Ask AI sÅ‚uÅ¼y do:

* analizy wzorcÃ³w,
* porÃ³wnaÅ„,
* pytaÅ„ wymagajÄ…cych follow-upÃ³w,
* gÅ‚Ä™bszej eksploracji danych z Daily.

---

### 3. Daily â€” szczegÃ³Å‚y dziaÅ‚ania

#### 3.1 UX Daily

* Jedna strona `/daily`.
* WyglÄ…da jak chat:

  * agent inicjuje dzieÅ„ pytaniem,
  * uÅ¼ytkownik wpisuje kolejne myÅ›li,
  * agent moÅ¼e okazjonalnie zareagowaÄ‡ (jednorazowo).
* Brak moÅ¼liwoÅ›ci:

  * tworzenia nowych wÄ…tkÃ³w,
  * odpowiadania â€w wÄ…tkuâ€,
  * kontynuowania dialogu w nieskoÅ„czonoÅ›Ä‡.

KaÅ¼da wiadomoÅ›Ä‡ jest **nowym checkpointem dnia**.

---

#### 3.2 Daily Events (model danych)

KaÅ¼da wiadomoÅ›Ä‡ zapisywana jako osobny rekord:

```
daily_events
- id
- user_id
- date
- role: user | agent | system
- type: note | question | note+question | answer | summary
- content
- created_at
```

Nie istnieje `thread_id` dla Daily.

---

### 4. ObsÅ‚uga pytaÅ„ w Daily (edge case)

JeÅ›li uÅ¼ytkownik w Daily napisze coÅ› w stylu:

> â€Mam pomysÅ‚ na template Framera. Czy moÅ¼esz powiedzieÄ‡, kiedy ostatnio robiÅ‚em template?â€

System:

1. Zapisuje caÅ‚oÅ›Ä‡ jako `daily_event` (note+question).
2. Klasyfikuje intencjÄ™ (note / question / note+question).
3. JeÅ›li zawiera pytanie:

   * agent robi **jednorazowy retrieval** z long-term memory (Supabase),
   * generuje odpowiedÅº inline,
   * odpowiedÅº zapisywana jest jako kolejny `daily_event`.

â— Nie tworzony jest thread.
â— Nie utrzymywana jest konwersacja.

JeÅ›li user zacznie dopytywaÄ‡ â†’ system sugeruje przejÅ›cie do `/ask`.

---

### 5. Ask AI â€” szczegÃ³Å‚y dziaÅ‚ania

* KaÅ¼da rozmowa ma `thread_id`.
* PeÅ‚na historia rozmowy przechowywana jako short-term memory.
* Przy kaÅ¼dej odpowiedzi:

  * agent robi retrieval z long-term memory (Daily + Summaries),
  * buduje prompt z hierarchii pamiÄ™ci.

Ask AI jest jedynym miejscem, gdzie:

* istniejÄ… wÄ…tki,
* uÅ¼ytkownik prowadzi dialog,
* agent â€pamiÄ™taâ€ rozmowÄ™.

---

### 6. PamiÄ™Ä‡ i Supabase

#### 6.1 Long-term memory (persistent)

Przechowywana w Supabase:

* surowe `daily_events`,
* `daily_summaries`,
* `weekly_summaries`,
* `monthly_summaries`,
* embeddings (vector store).

KaÅ¼dy wpis uÅ¼ytkownika:

* jest zapisywany jako raw text,
* jest embeddingowany,
* trafia do vector store.

---

#### 6.2 Short-term memory

* UÅ¼ywane TYLKO w Ask AI.
* Oparte o thread state.
* Nigdy nie uÅ¼ywane w Daily.

---

### 7. Hierarchia pamiÄ™ci (bardzo waÅ¼ne)

Agent **nigdy nie czyta wszystkiego**.

Hierarchia:

1. Monthly summaries
2. Weekly summaries
3. Daily summaries
4. Raw daily events (tylko jeÅ›li trzeba, semantycznie)

Ask AI zaczyna zawsze od najwyÅ¼szego poziomu abstrakcji.

---

### 8. Podsumowania (systemowe)

#### 8.1 Daily Summary

* Uruchamiane automatycznie przez system (cron).
* StaÅ‚a godzina: 20:00â€“22:00 (per strefa czasowa usera).
* JeÅ›li user byÅ‚ aktywny niedawno â†’ grace window (opÃ³Åºnienie).
* Input:

  * wszystkie daily_events z danego dnia.
* Output:

  * 2â€“4 fakty,
  * 1 insight,
  * opcjonalna sugestia.

Zapisywane jako:

```
daily_summaries
- user_id
- date
- content
- created_at
```

---

#### 8.2 Weekly Summary

* Raz w tygodniu (np. niedziela).
* Input: **tylko daily_summaries**.
* Cel: wykrywanie wzorcÃ³w.

---

#### 8.3 Monthly Summary

* Raz w miesiÄ…cu.
* Input: weekly + daily summaries.
* Cel: refleksja strategiczna, trendy.

---

### 9. Historia w Daily (scrollowanie)

* Dzisiaj: peÅ‚ny chat-like timeline.
* Wczoraj: domyÅ›lnie tylko daily summary (z opcjÄ… â€rozwiÅ„ dzieÅ„â€).
* TydzieÅ„: weekly summary.
* MiesiÄ…c: monthly insights.

â— Brak nieskoÅ„czonego scrolla do poczÄ…tku czasu.
â— Historia jest **progresywnie kondensowana**.

---

### 10. Kluczowe zasady architektoniczne

* Daily = chat UI + event-based memory.
* Ask = chat UI + thread-based memory.
* Supabase = ÅºrÃ³dÅ‚o prawdy dla long-term memory.
* Agent nigdy nie dostaje peÅ‚nej historii â€” tylko relewantne fragmenty.
* Podsumowania sÄ… robione asynchronicznie przez system.

---

### 11. Jedno zdanie podsumowujÄ…ce produkt

---

### 12. Struktura agentÃ³w (DeepAgents) â€” foldery i odpowiedzialnoÅ›ci

System oparty jest o **jeden nadrzÄ™dny agent** oraz **wyspecjalizowane sub-agenty (micro-agents)**.
Agenci NIE sÄ… rozproszeni po caÅ‚ym kodzie â€” majÄ… **jasnÄ… strukturÄ™ katalogÃ³w i kontrakty odpowiedzialnoÅ›ci**.

---

## 12.1 GÅ‚Ã³wna zasada architektoniczna agentÃ³w

* Jeden **Root Agent** (orchestrator)
* Wiele **wyspecjalizowanych sub-agentÃ³w**
* Sub-agenty:

  * nie znajÄ… UI,
  * nie znajÄ… threadÃ³w,
  * wykonujÄ… jedno konkretne zadanie,
  * zapisujÄ… wynik do Supabase lub zwracajÄ… structured output.

Root Agent:

* decyduje *ktÃ³ry agent* ma zostaÄ‡ uÅ¼yty,
* Å‚Ä…czy wyniki,
* decyduje co zapisaÄ‡ do memory.

---

## 12.2 Struktura folderÃ³w (monorepo)

Agenty sÄ… trzymane **wewnÄ…trz repo SaaS**, jako osobny pakiet:

```
/packages
  /agents
    /core
      root.agent.ts
      planner.agent.ts
      classifier.agent.ts

    /daily
      daily-intake.agent.ts
      daily-response.agent.ts
      daily-summary.agent.ts

    /ask
      ask-router.agent.ts
      ask-answer.agent.ts

    /summaries
      weekly-summary.agent.ts
      monthly-summary.agent.ts

    /retrieval
      memory-retriever.agent.ts

    /schemas
      daily.schema.ts
      summary.schema.ts
      ask.schema.ts

    index.ts
```

---

## 12.3 Opis agentÃ³w (odpowiedzialnoÅ›ci)

### ğŸ§  `root.agent`

* punkt wejÅ›cia dla wszystkich wywoÅ‚aÅ„ AI
* NIE generuje odpowiedzi koÅ„cowej
* odpowiada za:

  * routing,
  * delegacjÄ™ do sub-agentÃ³w,
  * zebranie wynikÃ³w,
  * zapis do memory

---

### ğŸ§­ `classifier.agent`

* klasyfikuje input uÅ¼ytkownika:

  * note
  * question
  * note + question
  * ask-style (eskalacja)
* dziaÅ‚a synchronicznie
* zwraca **structured output** (enum)

---

### ğŸ“¥ Daily Agents

#### `daily-intake.agent`

* przyjmuje pojedynczÄ… wiadomoÅ›Ä‡ z Daily
* nie zna historii dnia
* odpowiada na pytanie:

  > â€czy na to trzeba reagowaÄ‡?â€

#### `daily-response.agent`

* generuje **jednorazowÄ… reakcjÄ™ agenta**
* tylko jeÅ›li input zawiera pytanie
* brak follow-upÃ³w

#### `daily-summary.agent`

* uruchamiany asynchronicznie (cron)
* input: wszystkie daily_events z dnia
* output:

  * summary
  * insight
  * optional suggestion

---

### ğŸ’¬ Ask Agents

#### `ask-router.agent`

* punkt wejÅ›cia dla `/ask`
* decyduje:

  * jaki kontekst pobraÄ‡
  * jakiego agenta uÅ¼yÄ‡

#### `ask-answer.agent`

* generuje odpowiedÅº dla uÅ¼ytkownika
* pracuje na:

  * thread state
  * retrieved memory

---

### ğŸ“š Retrieval Agent

#### `memory-retriever.agent`

* jedyne miejsce w systemie, ktÃ³re:

  * robi semantic search
  * zna embedding store
* input:

  * query
  * user_id
* output:

  * lista relewantnych fragmentÃ³w pamiÄ™ci

---

## 12.4 Zasady komunikacji miÄ™dzy agentami

* Agenci **nie wywoÅ‚ujÄ… siÄ™ nawzajem bezpoÅ›rednio**
* Komunikacja odbywa siÄ™ przez:

  * Root Agent
  * lub LangGraph flow

KaÅ¼dy agent:

* ma **jeden responsibility**
* przyjmuje i zwraca **structured data**
* nie przechowuje stanu

---

## 12.5 Memory a agenci

* Å»aden agent:

  * nie ma dostÄ™pu do peÅ‚nej historii
  * nie Å‚aduje caÅ‚ych threadÃ³w
* Memory jest zawsze:

  * fetchowane selektywnie
  * przekazywane jawnie do prompta

---

## 12.6 Zasada skalowania

Nowy agent moÅ¼e zostaÄ‡ dodany tylko jeÅ›li:

* ma jasno zdefiniowane wejÅ›cie i wyjÅ›cie
* rozwiÄ…zuje jeden problem
* nie dubluje odpowiedzialnoÅ›ci innego agenta

---
---

### 12. DeepAgents â€” wykorzystanie i integracja

W caÅ‚ej architekturze produktowej **DeepAgents (z LangGraph)** sÄ… gÅ‚Ã³wnÄ… warstwÄ… orkiestracji zachowaÅ„ AI, odpowiadajÄ…cÄ… za:

1. **KlasyfikacjÄ™ intencji** (note vs question vs escalation),
2. **Routing logiki** (Daily â†’ Ask â†’ Summary),
3. **DelegacjÄ™ do wyspecjalizowanych agentÃ³w** (micro-agents),
4. **Wykonywanie zapytaÅ„ do long-term memory**,
5. **Generowanie odpowiedzi i insightÃ³w**.

DeepAgents sÄ… wykorzystywane jako **strukturalny sposÃ³b implementacji agent workflow**, zgodnie z dokumentacjÄ…:
[https://docs.langchain.com/oss/python/deepagents/overview](https://docs.langchain.com/oss/python/deepagents/overview)

---

#### 12.1 Jak DeepAgents sÄ… uÅ¼ywane w systemie

DeepAgents sÄ… stosowane w nastÄ™pujÄ…cych elementach:

* **Root Agent / Orchestrator**
  â€” centralny agent, ktÃ³ry deleguje do sub-agentÃ³w np. classifier, retriever, answerer.

* **Daily flow agents**
  â€” mikro-agenty, ktÃ³re obsÅ‚ugujÄ… pojedyncze wiadomoÅ›ci w Daily, w tym:

  * analiza nowego wpisu,
  * single-shot odpowiedÅº, jeÅ›li zawiera pytanie.

* **Ask AI agents**
  â€” mikro-agenty odpowiadajÄ…ce za tradycyjny chat:

  * pobieranie relevant memory,
  * generowanie odpowiedzi,
  * zarzÄ…dzanie historiÄ… rozmowy (thread).

* **Summary agents**
  â€” osobne workflowy uruchamiane przez scheduler:

  * Daily Summary Agent,
  * Weekly Summary Agent,
  * Monthly Summary Agent.

Dla kaÅ¼dego z tych workflowÃ³w DeepAgents:

* budujÄ… plan wykonania (planner),
* wykonujÄ… zadania w sekwencji lub rÃ³wnolegle,
* zwracajÄ… **structured output**, ktÃ³ry jest zapisywany do Supabase i long-term memory.

---

#### 12.2 Jak orkiestracja DeepAgents powinna dziaÅ‚aÄ‡

Orkiestracja agentÃ³w opiera siÄ™ na **LangGraph workflows**, w ktÃ³rych:

1. **Root agent** otrzymuje wejÅ›cie (np. nowy wpis, pytanie, trigger summary),
2. **Classifier agent** identyfikuje intencjÄ™ i decyduje o dalszym flow,
3. **Retriever agent** pobiera semantyczne fragmenty pamiÄ™ci (Supabase embeddings),
4. **Answer agent** generuje finalnÄ… odpowiedÅº lub summary,
5. **Saver agent** zapisuje wyniki i aktualizuje memory.

PrzepÅ‚yw ten jest zdefiniowany jako **strukturalny graph nodes â†’ edges**, dziÄ™ki czemu:

* jest czytelny,
* Å‚atwy do debugowania,
* skalowalny,
* zgodny z rekomendowanÄ… praktykÄ… DeepAgents.

---

#### 12.3 Backends i integracja

DeepAgents mogÄ… dziaÅ‚aÄ‡ w nastÄ™pujÄ…cych Å›rodowiskach backendowych:

* Node.js/TypeScript (LangChain.js DeepAgents),
* Python (LangChain Python DeepAgents).

W kontekÅ›cie tego produktu rekomendowany jest **LangGraph** jako warstwa orkiestracji, z integracjÄ…:

* **Supabase jako pamiÄ™Ä‡ dÅ‚ugoterminowa** (vector store + summaries),
* **Edge/Serverless Functions** do odpalania agent tasks,
* **Scheduler (pg_cron / cron)** do summary jobs.

---

#### 12.4 NajwaÅ¼niejsze efekty integracji DeepAgents

DziÄ™ki wykorzystaniu DeepAgents system uzyskuje:

* **modularne workflowy agentowe**, Å‚atwe do testowania,
* **separacjÄ™ odpowiedzialnoÅ›ci** miÄ™dzy rÃ³Å¼nymi funkcjami AI,
* **jasnÄ… hierarchiÄ™ pamiÄ™ci** i retrieval,
* **kontrolÄ™ nad promptami i state**,
* moÅ¼liwoÅ›Ä‡ Å‚atwego wprowadzenia nowych agentÃ³w (np. integrations / tools).

---

### 13. Rola DeepAgents w hierarchii pamiÄ™ci

DeepAgents operujÄ… na **hierarchii semantycznej pamiÄ™ci**:

1. Monthly summaries,
2. Weekly summaries,
3. Daily summaries,
4. Raw daily events (via retriever, top N).

DeepAgents nie Å‚adujÄ… peÅ‚nej historii do LLM â€” uÅ¼ywajÄ… **retrieval + planning**, aby zmieÅ›ciÄ‡ kontekst w ograniczeniach tokenÃ³w i generowaÄ‡ relewantne odpowiedzi.

---

### 14. Kilka sÅ‚Ã³w o dokumentacji

Integracja i implementacja DeepAgents powinna byÄ‡ zgodna z OSS guide:
[https://docs.langchain.com/oss/python/deepagents/overview](https://docs.langchain.com/oss/python/deepagents/overview)

---